(function($,w,d,u){'use strict';modx.tree_parent=modx.tree_parent||0,modx.extended({frameset:"frameset",minWidth:840,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),typesactions:{16:1,301:2,78:3,22:4,102:5,108:6,3:7,4:7,6:7,27:7,61:7,62:7,63:7,72:7},thememodes:["","lightness","light","dark","darkness"],tabsTimer:0,popupTimer:0,init:function(){localStorage.getItem("MODX_widthSideBar")||localStorage.setItem("MODX_widthSideBar",this.config.tree_width),this.mainmenu.init();var e=modx.normalizeUrl(w.location.href);if(e)if(modx.getActionFromUrl(e,2))w.history.replaceState(null,d.title,modx.MODX_MANAGER_URL);else if(modx.getActionFromUrl(e)||modx.main.getQueryVariable("filemanager",e)||/^modules\//.test(e)){var t=modx.main.getQueryVariable("filemanager",e)?modx.MODX_MANAGER_URL+modx.main.getQueryVariable("filemanager",e)+e:e;modx.config.global_tabs?modx.tabs({url:t,title:"blank"}):w.main?w.main.frameElement.src=t:modx.openWindow(t)}this.resizer.init(),this.search.init(),0<this.config.session_timeout&&w.setInterval(this.keepMeAlive,60000*this.config.session_timeout),0<modx.config.mail_check_timeperiod&&modx.permission.messages&&setTimeout("modx.updateMail(true)",1e3),d.addEventListener("click",this.hideDropDown,!1),modx.config.global_tabs&&(d.addEventListener("click",this.tabs,!1),this.tabs({url:"?a=2",reload:0}))},mainmenu:{id:"mainMenu",init:function(){var t,n=$("#mainMenu"),a=d.getElementById("mainMenu");n.on("click","a",function(t){$(this).hasClass("dropdown-toggle")&&(n.hasClass("show")&&($(this).hasClass("selected")||!modx.isMobile&&$(this).parent().hasClass("hover"))?($(this).removeClass("selected"),n.removeClass("show")):($(".nav > li > a:not(:hover)").removeClass("selected"),$(this).addClass("selected"),n.addClass("show")),t.stopPropagation(),t.target.dataset.toggle="#mainMenu",modx.hideDropDown(t)),$(this).closest("ul").hasClass("dropdown-menu")&&!$(this).parent("li").hasClass("dropdown-back")&&($(".nav > .active").removeClass("active"),$(".nav li.selected").removeClass("selected"),$(this).closest(".nav > li").addClass("active"),this.offsetParent.id&&d.getElementById(this.offsetParent.id.substr(7)).classList.add("selected"),(modx.isMobile||w.innerWidth<modx.minWidth)&&$(t.target).hasClass("toggle")&&(this.parentNode.classList.add("selected"),t.stopPropagation(),t.preventDefault()))}).on("mouseenter",".nav > li",function(){for(var e=a.querySelectorAll(".nav > li.hover:not(:hover)"),t=0;t<e.length;t++)e[t].classList.remove("hover");this.classList.add("hover")}).on("click",".nav li",function(){(modx.isMobile||w.innerWidth<modx.minWidth)&&$(".nav ul.selected",n).removeClass("selected")}).on("mouseenter",".nav > li li",function(o){for(var e,s=this,r=a.querySelectorAll(".nav > li li.hover:not(:hover)"),l=0;l<r.length;l++)r[l].classList.remove("hover");this.classList.add("hover"),clearTimeout(t),this.offsetParent.nextElementSibling&&this.offsetParent.nextElementSibling.classList.contains("sub-menu")?e=this.offsetParent.nextElementSibling:this.offsetParent&&this.offsetParent.classList.contains("sub-menu")?e=this.offsetParent:(e=d.createElement("ul"),e.className="sub-menu dropdown-menu",this.parentNode.parentNode.appendChild(e)),t=setTimeout(function(){d.querySelector(".nav .sub-menu.show")&&d.querySelector(".nav .sub-menu.show").classList.remove("show"),e.style.left=s.offsetWidth+"px",s.classList.contains("dropdown-toggle")?e.id==="parent_"+s.id?(modx.isMobile?s.parentNode.classList.add("selected"):s.onclick=function(t){t.target.classList.contains("toggle")&&s.parentNode.classList.add("selected")},e.classList.add("show")):(e.classList.remove("show"),$(".nav ul.selected",n).removeClass("selected"),t=setTimeout(function(){var n=s.firstElementChild.href&&"main"===s.firstElementChild.target?s.firstElementChild.href.split("?")[1]+"&elements="+s.id:"";modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",n,function(a){if(a){(modx.isMobile||w.innerWidth<modx.minWidth)&&(a="<li class=\"dropdown-back\"><span class=\"dropdown-item\"><i class=\""+modx.style.icon_angle_left+"\"></i>"+modx.lang.paging_prev+"</span></li>"+a),e.id="parent_"+s.id,e.innerHTML=a;var r=w.location.hash.substr(2).replace(/=/g,"_").replace(/&/g,"__"),l=d.getElementById(r);l&&(l.parentNode.classList.add("selected"),d.getElementById(l.parentNode.parentNode.id.substr(7)).classList.add("selected"));for(var c=0;c<e.children.length;c++)l=e.children[c],l.classList.contains("dropdown-back")&&(l.onclick=function(t){t.target.offsetParent.previousElementSibling.classList.remove("selected"),t.target.offsetParent.classList.remove("show"),t.preventDefault(),t.stopPropagation()}),l.onmouseenter=function(n){clearTimeout(t);var e=n.target.offsetParent.querySelector("li.hover");e&&e.classList.remove("hover"),n.target.classList.add("hover"),s.classList.add("hover"),n.preventDefault(),n.stopPropagation()};e.classList.add("show"),modx.isMobile?o.target.classList.contains("toggle")&&s.parentNode.classList.add("selected"):s.onclick=function(t){t.target.classList.contains("toggle")&&s.parentNode.classList.add("selected")},setTimeout(function(){modx.mainmenu.search(n,e)},200)}})},85)):e.classList.contains("open")&&(e.classList.remove("open"),setTimeout(function(){e.parentNode.removeChild(e)},100))},85),o.preventDefault()})},search:function(t,n){var a,o=n.querySelector("input[name=filter]"),i=-1,s=null;o&&(!modx.isMobile&&o.focus(),o.onkeyup=function(r){13===r.keyCode&&n.querySelector(".item.hover")?(d.body.click(),s=n.querySelector(".item.hover").firstChild,modx.tabs({url:s.href,title:s.innerHTML})):38===r.keyCode||40===r.keyCode?(o.selectionStart=o.value.length,a=n.querySelectorAll(".item"),a.length&&(40===r.keyCode?i++:i--,0>i?(i=-1,s=n.querySelector(".hover"),s&&s.classList.remove("hover")):i>a.length-1&&(i=a.length-1),0<=i&&i<a.length&&(s=n.querySelector(".hover"),s&&s.classList.remove("hover"),a[i].classList.add("hover")))):modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",t+"&filter="+o.value,function(e){i=-1,$(".item",n).remove(),$(n).append(e).on("mouseenter",".item",function(t){$(this).addClass("hover").closest("ul").find("li:not(:hover)").removeClass("hover"),t.stopPropagation()})},"html")})}},search:{result:null,results:null,input:null,mask:null,loader:null,timer:0,init:function(){this.result=d.getElementById("searchresult"),this.input=d.getElementById("searchid"),this.mask=d.querySelector("#searchform .mask"),this.result||(this.result=d.createElement("div"),this.result.id="searchresult",d.body.appendChild(this.result)),this.loader=d.createElement("i"),this.loader.className=modx.style.icon_refresh+modx.style.icon_spin,this.input.parentNode.appendChild(this.loader),modx.config.global_tabs&&(this.input.parentNode.onsubmit=function(t){t.preventDefault(),this.target="mainsearch",modx.tabs({url:this.action,title:"Search",name:"mainsearch"}),this.submit()});var t=this;this.input.onkeyup=function(n){n.preventDefault(),clearTimeout(t.timer),""!==t.input.value.length&&2<t.input.value.length?t.timer=setTimeout(function(){t.loader.style.display="block",modx.get(modx.MODX_MANAGER_URL+"?a=71&ajax=1&submitok=Search&searchid="+t.input.value,function(e){t.loader.style.display="none",t.results=e.querySelector(".ajaxSearchResults"),t.results&&""!==t.results.innerHTML?(t.result.innerHTML=t.results.outerHTML,t.open(),t.result.onclick=function(n){var e=n.target,o=e.parentNode;if("I"===e.tagName)modx.openWindow({title:o.innerText,id:o.id,url:o.href}),n.preventDefault(),n.stopPropagation();else{var i="A"===e.tagName&&e||"A"===o.tagName&&o;if(i){var a=t.result.querySelector(".selected");a&&(a.className=""),i.className="selected",modx.isMobile&&t.close()}}}):t.empty()},"document")},300):t.empty()},modx.isMobile&&(this.input.onblur=this.close),this.input.onfocus=this.open,this.input.onclick=this.open,this.input.onmouseenter=this.open,this.result.onmouseenter=this.open,this.result.onmouseleave=this.close,this.mask.onmouseenter=this.open,this.mask.onmouseleave=this.close},open:function(){modx.search.results&&modx.search.result.classList.add("open")},close:function(){modx.search.result.classList.remove("open")},empty:function(){modx.search.result.classList.remove("open"),modx.search.result.innerHTML=""}},main:{id:"main",idFrame:"mainframe",as:null,onload:function(t){w.main=t.target.contentWindow||t.target.defaultView,modx.main.tabRow.init(),modx.main.stopWork(),modx.main.scrollWork(),w.main.document.addEventListener("click",modx.hideDropDown,!1),w.main.document.addEventListener("contextmenu",modx.main.oncontextmenu,!1),modx.config.global_tabs&&w.main.document.addEventListener("click",modx.tabs,!1);var e=modx.normalizeUrl(w.main.location.href);w.history.replaceState(null,d.title,modx.getActionFromUrl(e,2)?modx.MODX_MANAGER_URL:"#"+e),setTimeout("modx.tree.restoreTree()",100)},oncontextmenu:function(t){if(!t.ctrlKey){var e=t.target;if(1===modx.user.role&&/modxtv|modxplaceholder|modxattributevalue|modxchunk|modxsnippet|modxsnippetnocache/i.test(e.className)){var a=Date.now(),o=e.innerText.replace(/[\[|\]|{|}|\*||\#|\+|?|\!|&|=|`|:]/g,""),i=e.className.replace(/cm-modx/,""),s=!!o.replace(/^\d+$/,"");o&&s&&(t.preventDefault(),modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",{a:"modxTagHelper",name:o,type:i},function(n){if(n){for(var i in n=JSON.parse(n),n)n.hasOwnProperty(i)&&n[i].url&&(n[i].onclick="if(event.shiftKey){modx.openWindow({url:'"+n[i].url+"'})}else{modx.popup({url:'"+n[i].url+"',title:'"+n.header.innerHTML+"',width:'95%',height:'95%',margin:0,hide:0,hover:0,overlay:1,overlayclose:0,position:'center elements',animation:0,icon:'none'})}");n=JSON.stringify(n),e.id="node"+a,e.dataset.contextmenu=n,modx.tree.showPopup(t,a,o)}})),t.preventDefault()}}},tabRow:{init:function(){var e=w.main.document.querySelector(".tab-pane > .tab-row");e&&this.build(e)},build:function(t){var a=d.createElement("div"),o=t.querySelector(".selected");a.className="tab-row-container",t.parentNode.insertBefore(a,t),a.appendChild(t);var i=d.createElement("i");i.className=modx.style.icon_angle_left+" prev disable",i.onclick=function(n){n.stopPropagation(),n.preventDefault();var e=t.querySelector(".selected");e.previousSibling&&(e.previousSibling.click(),modx.main.tabRow.scroll(t))},a.appendChild(i);var e=d.createElement("i");e.className=modx.style.icon_angle_right+" next disable",e.onclick=function(n){n.stopPropagation(),n.preventDefault();var e=t.querySelector(".selected");e.nextSibling&&(e.nextSibling.click(),modx.main.tabRow.scroll(t))},a.appendChild(e),setTimeout(function(){o=t.querySelector(".selected"),modx.main.tabRow.scroll(t,o),w.main.addEventListener("resize",function(){modx.main.tabRow.scroll(t)},!1),o&&(o.previousSibling&&i.classList.remove("disable"),o.nextSibling&&e.classList.remove("disable"))},100),t.onclick=function(t){var e="H2"===t.target.tagName?t.target:"SPAN"===t.target.tagName?t.target.parentNode:null;e&&(e.previousSibling?this.parentNode.querySelector("i.prev").classList.remove("disable"):this.parentNode.querySelector("i.prev").classList.add("disable"),e.nextSibling?this.parentNode.querySelector("i.next").classList.remove("disable"):this.parentNode.querySelector("i.next").classList.add("disable"),modx.main.tabRow.scroll(this,e))}},scroll:function(e,t,n){t=t||e.querySelector(".selected")||e.firstChild,n=n||100;for(var o=0,s=e.childNodes,r=0;r<s.length;r++)o+=s[r].offsetWidth;e.scrollLeft>t.offsetLeft&&$(e).animate({scrollLeft:t.offsetLeft-(t.previousSibling?30:1)},n),t.offsetLeft+t.offsetWidth>e.offsetWidth+e.scrollLeft&&$(e).animate({scrollLeft:t.offsetLeft-e.offsetWidth+t.offsetWidth+(t.nextSibling?30:0)},n),o>e.offsetWidth&&this.drag(e)},drag:function(t){t.onmousedown=function(n){if(0===n.button){n.preventDefault();var a=n.clientX,o=t.scrollLeft;t.ownerDocument.body.focus(),t.onmousemove=t.ownerDocument.onmousemove=function(n){5<Math.abs(n.clientX-a)&&(n.stopPropagation(),t.scrollLeft=o-(n.clientX-a),t.ownerDocument.body.classList.add("drag"))},t.onmouseup=t.ownerDocument.onmouseup=function(n){n.stopPropagation(),t.onmousemove=null,t.ownerDocument.onmousemove=null,t.ownerDocument.body.classList.remove("drag")}}}}},work:function(){d.getElementById("mainloader").classList.add("show")},stopWork:function(){d.getElementById("mainloader").classList.remove("show")},scrollWork:function(){var e=w.main.frameElement.contentWindow,t=modx.normalizeUrl(e.location.href),n=localStorage.getItem("page_y")||0,a=localStorage.getItem("page_url")||t;(modx.getActionFromUrl(a)===modx.getActionFromUrl(t)&&modx.main.getQueryVariable("id",a)&&modx.main.getQueryVariable("id",a)===modx.main.getQueryVariable("id",t)||a===t)&&e.scrollTo(0,n),e.addEventListener("scroll",function(){0<=this.pageYOffset&&(localStorage.setItem("page_y",this.pageYOffset.toString()),localStorage.setItem("page_url",t))},!1)},getQueryVariable:function(e,t){var n="";if(t||"string"==typeof t){t=t.split("?"),t=t[1]||t[0],t=t.split("&");for(var a,o=0;o<t.length;o++)a=t[o].split("="),a[0]===e&&(n=decodeURIComponent(a[1]))}return n}},resizer:{dragElement:null,oldZIndex:99,newZIndex:999,left:modx.config.tree_width,id:"resizer",switcher:"hideMenu",background:"rgba(0, 0, 0, 0.1)",mask:null,init:function(){if(d.getElementById(modx.resizer.id)&&(modx.resizer.mask=d.createElement("div"),modx.resizer.mask.id="mask_resizer",modx.resizer.mask.style.zIndex=modx.resizer.oldZIndex,d.getElementById(modx.resizer.id).onmousedown=modx.resizer.onMouseDown,d.getElementById(modx.resizer.id).onmouseup=modx.resizer.mask.onmouseup=modx.resizer.onMouseUp,modx.isMobile)){var t,n,a=d.getElementById("tree"),o=a.offsetWidth;d.getElementById("frameset").appendChild(modx.resizer.mask),w.addEventListener("touchstart",function(a){/tab|tab\-row|tab\-row\-container/.test(a.target.className||a.target.offsetParent.className)?this.swipe=!1:(t=a.changedTouches[0].clientX,n=a.changedTouches[0].clientY,this.swipe=!0,this.sidebar=!d.body.classList.contains("sidebar-closed"))},!1),w.addEventListener("touchmove",function(i){var e=i.changedTouches[0];a.style.transition="none",a.style.WebkitTransition="none",modx.resizer.mask.style.transition="none",modx.resizer.mask.style.WebkitTransition="none",modx.resizer.mask.style.visibility="visible";var s=e.clientX-t,r=e.clientY-n;Math.abs(s)>Math.abs(r)&&this.swipe&&(0>s&&this.sidebar?(Math.abs(s)>o&&(s=-o),a.style.transform="translate3d("+s+"px, 0, 0)",a.style.WebkitTransform="translate3d("+s+"px, 0, 0)",modx.resizer.mask.style.opacity=(.5-.5/-o*s).toFixed(2),this.swipe=Math.abs(s)>o/3?"left":"right"):0<s&&!this.sidebar&&(Math.abs(s)>o&&(s=o),a.style.transform="translate3d("+-(o-s)+"px, 0, 0)",a.style.WebkitTransform="translate3d("+-(o-s)+"px, 0, 0)",modx.resizer.mask.style.opacity=(.5/o*s).toFixed(2),this.swipe=Math.abs(s)>o/3?"right":"left"))},!1),w.addEventListener("touchend",function(){"left"===this.swipe&&(d.body.classList.add("sidebar-closed"),modx.resizer.setWidth(0)),"right"===this.swipe&&(d.body.classList.remove("sidebar-closed"),modx.resizer.setWidth(o)),a.style.cssText="",modx.resizer.mask.style.cssText=""},!1)}},onMouseDown:function(t){if(t=t||w.event,modx.resizer.dragElement=null===t.target?t.srcElement:t.target,(1===t.buttons||0===t.button)&&modx.resizer.dragElement.id===modx.resizer.id)return modx.resizer.oldZIndex=modx.resizer.dragElement.style.zIndex,modx.resizer.dragElement.style.zIndex=modx.resizer.newZIndex,modx.resizer.dragElement.style.background=modx.resizer.background,localStorage.setItem("MODX_widthSideBar",0<modx.resizer.dragElement.offsetLeft?modx.resizer.dragElement.offsetLeft:0),d.body.appendChild(modx.resizer.mask),d.onmousemove=modx.resizer.onMouseMove,d.body.focus(),d.body.classList.add("resizer_move"),d.onselectstart=function(){return!1},modx.resizer.dragElement.ondragstart=function(){return!1},!1},onMouseMove:function(t){t=t||w.event,modx.resizer.left=0<t.clientX?t.clientX:0,modx.resizer.dragElement.style.left=modx.pxToRem(modx.resizer.left)+"rem",d.getElementById("tree").style.width=modx.pxToRem(modx.resizer.left)+"rem",d.getElementById("main").style.left=modx.pxToRem(modx.resizer.left)+"rem",(-2>t.clientX||-2>t.clientY)&&modx.resizer.onMouseUp(t)},onMouseUp:function(t){null!==modx.resizer.dragElement&&0===t.button&&modx.resizer.dragElement.id===modx.resizer.id&&(0<t.clientX?(d.body.classList.remove("sidebar-closed"),modx.resizer.left=t.clientX):(d.body.classList.add("sidebar-closed"),modx.resizer.left=0),d.cookie="MODX_widthSideBar="+modx.pxToRem(modx.resizer.left),modx.resizer.dragElement.style.zIndex=modx.resizer.oldZIndex,modx.resizer.dragElement.style.background="",modx.resizer.dragElement.ondragstart=null,modx.resizer.dragElement=null,d.body.classList.remove("resizer_move"),d.body.removeChild(modx.resizer.mask),d.onmousemove=null,d.onselectstart=null)},toggle:function(){if(modx.isMobile||w.innerWidth<=modx.minWidth)d.body.classList.contains("sidebar-closed")?(d.body.classList.remove("sidebar-closed"),localStorage.setItem("MODX_widthSideBar",0),d.cookie="MODX_widthSideBar="+modx.pxToRem(parseInt(d.getElementById("tree").offsetWidth))):(localStorage.setItem("MODX_widthSideBar",parseInt(d.getElementById("tree").offsetWidth)),d.body.classList.add("sidebar-closed"),d.cookie="MODX_widthSideBar=0");else{var e=0===d.getElementById("tree").offsetWidth?parseInt(localStorage.getItem("MODX_widthSideBar"))?parseInt(localStorage.getItem("MODX_widthSideBar")):modx.config.tree_width:0;modx.resizer.setWidth(e)}},setWidth:function(e){0<e?(localStorage.setItem("MODX_widthSideBar",0),d.body.classList.remove("sidebar-closed")):(localStorage.setItem("MODX_widthSideBar",parseInt(d.getElementById("tree").offsetWidth)),d.body.classList.add("sidebar-closed")),d.cookie="MODX_widthSideBar="+modx.pxToRem(e),d.getElementById("tree").style.width=modx.pxToRem(e)+"rem",d.getElementById("resizer").style.left=modx.pxToRem(e)+"rem",d.getElementById("main").style.left=modx.pxToRem(e)+"rem"},setDefaultWidth:function(){modx.resizer.setWidth(modx.remToPx(modx.config.tree_width))}},tree:{ctx:null,rpcNode:null,itemToChange:"",selectedObjectName:null,selectedObject:0,selectedObjectDeleted:0,selectedObjectUrl:"",drag:!1,deleted:[],init:function(){this.restoreTree()},draggable:function(){if(modx.permission.dragndropdocintree)for(var e,t=d.querySelectorAll("#treeRoot a:not(.empty)"),n=0;n<t.length;n++)e=t[n],e.onmousedown=this.onmousedown,e.ondragstart=this.ondragstart,e.ondragenter=this.ondragenter,e.ondragover=this.ondragover,e.ondragleave=this.ondragleave,e.ondrop=this.ondrop},onmousedown:function(t){if(t.ctrlKey)return this.parentNode.removeAttribute("draggable"),!0;var e=this.dataset.roles+("treeRoot"===this.parentNode.parentNode.id?"":this.parentNode.parentNode.previousSibling.dataset.roles),n=!1;n=""==e||e.split(",").map(Number).filter(function(e){return~modx.user.groups.indexOf(parseInt(e))}).length;var a=!(e&&1!==modx.user.role)||n;modx.tree.itemToChange=this.dataset.id||this.parentNode.id.replace("node",""),modx.tree.selectedObjectName=this.dataset.titleEsc,a?(this.parentNode.draggable=!0,this.parentNode.ondragstart=modx.tree.ondragstart):(this.parentNode.draggable=!1,this.parentNode.ondragstart=function(){return!1})},ondragstart:function(t){t.dataTransfer.effectAllowed="all",t.dataTransfer.dropEffect="all",t.dataTransfer.setData("text",this.id.substr(4))},ondragenter:function(t){d.getElementById("node"+modx.tree.itemToChange)===(this.parentNode.closest("#node"+modx.tree.itemToChange)||this.parentNode)?(this.parentNode.className="",t.dataTransfer.effectAllowed="none",t.dataTransfer.dropEffect="none",modx.tree.drag=!1):(this.parentNode.className="dragenter",t.dataTransfer.effectAllowed="copy",t.dataTransfer.dropEffect="copy",modx.tree.drag=!0),t.preventDefault()},ondragover:function(t){if(modx.tree.drag){var e=t.clientY,n=parseInt(this.getBoundingClientRect().top),a=e-n;a>this.offsetHeight/1.51?(this.parentNode.classList.add("dragafter"),this.parentNode.classList.remove("dragbefore"),this.parentNode.classList.remove("dragenter"),t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move"):a<this.offsetHeight/3?(this.parentNode.classList.add("dragbefore"),this.parentNode.classList.remove("dragafter"),this.parentNode.classList.remove("dragenter"),t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move"):(this.parentNode.classList.add("dragenter"),this.parentNode.classList.remove("dragafter"),this.parentNode.classList.remove("dragbefore"),t.dataTransfer.effectAllowed="copy",t.dataTransfer.dropEffect="copy")}else t.dataTransfer.effectAllowed="none",t.dataTransfer.dropEffect="none",modx.tree.drag=!1;t.preventDefault()},ondragleave:function(t){this.parentNode.className="",this.parentNode.removeAttribute("draggable"),t.preventDefault()},ondrop:function(t){var e=d.getElementById("node"+modx.tree.itemToChange),n=null,a=modx.tree.itemToChange,o=0,s=[],r=0,l=e.firstChild.querySelector(".indent"),c=0;if(l.innerHTML="",e.removeAttribute("draggable"),this.parentNode.classList.contains("dragenter")){for(o=parseInt(this.parentNode.id.substr(4)),r=parseInt(this.dataset.level)+1,c=0;c<r;c++)l.innerHTML+="<i></i>";if(this.nextSibling)for(this.nextSibling.innerHTML?this.nextSibling.appendChild(e):e.parentNode.removeChild(e),n=this.parentNode.lastChild.children,c=0;c<n.length;c++)s[c]=n[c].id.substr(4);else e.parentNode.removeChild(e),d.querySelector("#node"+o+" .icon").innerHTML=parseInt(this.dataset.private)?modx.style.icon_folder:modx.style.icon_folder;modx.tree.ondragupdate(this,a,o,s)}if(this.parentNode.classList.contains("dragafter")){for(o=/node/.test(this.parentNode.parentNode.parentNode.id)?parseInt(this.parentNode.parentNode.parentNode.id.substr(4)):0,r=parseInt(this.dataset.level),c=0;c<r;c++)l.innerHTML+="<i></i>";for(this.parentNode.parentNode.insertBefore(e,this.parentNode.nextSibling),n=this.parentNode.parentNode.children,c=0;c<n.length;c++)s[c]=n[c].id.substr(4);modx.tree.ondragupdate(this,a,o,s)}if(this.parentNode.classList.contains("dragbefore")){for(o=/node/.test(this.parentNode.parentNode.parentNode.id)?parseInt(this.parentNode.parentNode.parentNode.id.substr(4)):0,r=parseInt(this.dataset.level),c=0;c<r;c++)l.innerHTML+="<i></i>";for(this.parentNode.parentNode.insertBefore(e,this.parentNode),n=this.parentNode.parentNode.children,c=0;c<n.length;c++)s[c]=n[c].id.substr(4);modx.tree.ondragupdate(this,a,o,s)}this.parentNode.removeAttribute("class"),this.parentNode.removeAttribute("draggable"),t.preventDefault()},ondragupdate:function(e,t,n,a){var o=e.dataset.roles+("treeRoot"===e.parentNode.parentNode.id?"":e.parentNode.parentNode.previousSibling.dataset.roles),i=!1;if(""!=o)i=o.split(",").map(Number).filter(function(e){return~modx.user.groups.indexOf(parseInt(e))}).length;else var i=!0;if(!!(o&&1!==modx.user.role)&&!i)return alert(modx.lang.error_no_privileges),void modx.tree.restoreTree();modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",{a:"movedocument",id:t,parent:n,menuindex:a},function(e){e.errors&&alert(e.errors),modx.tree.restoreTree()},"json");var s=modx.normalizeUrl(w.main.frameElement.contentWindow.location.href);if(modx.getActionFromUrl(s,27)&&parseInt(modx.main.getQueryVariable("id",s))===parseInt(t)){var r=a.indexOf(t),l=w.main.document.querySelector("#documentPane input[name=menuindex]"),c=w.main.document.querySelector("#documentPane input[name=parent]"),m=w.main.document.querySelector("#documentPane #parentName");l&&0<=r&&(l.value=r),c&&m&&(c.value=n,m.innerHTML=n+" ("+d.querySelector("#node"+n+" > a").dataset.titleEsc+")")}},toggleTheme:function(){var e,t,n=1,o=w.main.myCodeMirrors;for(t in"undefined"==typeof localStorage.MODX_themeMode&&(localStorage.MODX_themeMode=modx.config.theme_mode),modx.thememodes[parseInt(localStorage.MODX_themeMode)+1]&&(n=parseInt(localStorage.MODX_themeMode)+1),e=modx.thememodes[n],modx.thememodes)modx.thememodes[t]&&(d.body.classList.remove(modx.thememodes[t]),w.main.document.body.classList.remove(modx.thememodes[t]));if(d.body.classList.add(e),w.main.document.body.classList.add(e),d.cookie="MODX_themeMode="+n,localStorage.MODX_themeMode=n,"undefined"!=typeof o)for(t in o)o.hasOwnProperty(t)&&(~e.indexOf("dark")?(w.main.document.getElementsByName(t)[0].nextElementSibling.classList.add("cm-s-"+o[t].options.darktheme),w.main.document.getElementsByName(t)[0].nextElementSibling.classList.remove("cm-s-"+o[t].options.defaulttheme)):(w.main.document.getElementsByName(t)[0].nextElementSibling.classList.remove("cm-s-"+o[t].options.darktheme),w.main.document.getElementsByName(t)[0].nextElementSibling.classList.add("cm-s-"+o[t].options.defaulttheme)))},toggleNode:function(t,n){if(t=t||w.event,!t.ctrlKey){t.stopPropagation();var a=d.getElementById("node"+n).firstChild;this.rpcNode=a.nextSibling;var o=a.querySelector(".toggle"),i=a.querySelector(".icon");if(""===this.rpcNode.innerHTML){o&&(o.innerHTML=a.dataset.iconCollapsed),i.innerHTML=a.dataset.iconFolderOpen;var s=this.rpcNode.innerHTML,r=modx.lang.loading_doc_tree;if(modx.openedArray[n]=1,""===s||0<s.indexOf(r)){var l=this.getFolderState();d.getElementById("treeloader").classList.add("visible"),modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php","a=1&f=nodes&indent="+a.dataset.indent+"&parent="+n+"&expandAll="+a.dataset.expandall+l,function(e){modx.tree.rpcLoadData(e),modx.tree.draggable()})}this.saveFolderState()}else o&&(o.innerHTML=a.dataset.iconExpanded),i.innerHTML=a.dataset.iconFolderClose,delete modx.openedArray[n],this.rpcNode.style.overflow="hidden",$(this.rpcNode.firstChild).animate({marginTop:-this.rpcNode.offsetHeight+"px"},100,function(){this.parentNode.innerHTML=""}),this.saveFolderState();t.preventDefault()}},rpcLoadData:function(e){if(null!==this.rpcNode){var t;this.rpcNode.innerHTML="object"==typeof e?e.responseText:e,this.rpcNode.loaded=!0,"DIV"===this.rpcNode.firstChild.tagName?("treeRoot"===this.rpcNode.id?(t=d.getElementById("binFull"),t?this.showBin(!0):this.showBin(!1)):(this.rpcNode.style.overflow="hidden",this.rpcNode.firstElementChild.style.marginTop=-this.rpcNode.offsetHeight+"px",$(this.rpcNode.firstChild).animate({marginTop:0},100)),d.getElementById("treeloader").classList.remove("visible")):(t=d.getElementById("loginfrm"),t&&(this.rpcNode.parentNode.removeChild(this.rpcNode),w.location.href=modx.MODX_MANAGER_URL))}},treeAction:function(t,e,n){if(!t.ctrlKey){var a=d.getElementById("node"+e).firstChild,o=a.dataset.treepageclick,i=parseInt(a.dataset.showchildren),s=parseInt(a.dataset.openfolder);if(n=n||a.dataset&&a.dataset.titleEsc,"move"===tree.ca)try{this.setSelectedByContext(e),w.main.setMoveValue(e,n)}catch(e){alert(modx.lang.unable_set_parent)}if("open"===tree.ca||""===tree.ca){if(0===e)r="?a=2";else{var r="";r=!isNaN(o)&&isFinite(o)?"?a="+o+"&r=1&id="+e+(0===s?this.getFolderState():""):o,2===s&&(1!==i&&(r=""),this.toggleNode(t,e))}r&&(t.shiftKey?(w.getSelection().removeAllRanges(),modx.openWindow(r),this.restoreTree()):(modx.tabs({url:modx.MODX_MANAGER_URL+r,title:n+"<small>("+e+")</small>"}),modx.isMobile&&w.innerWidth<modx.minWidth&&modx.resizer.toggle())),this.itemToChange=e,this.setSelected(e)}if("parent"===tree.ca)try{this.setSelectedByContext(e),w.main.setParent(e,n)}catch(e){alert(modx.lang.unable_set_parent)}if("link"===tree.ca)try{this.setSelectedByContext(e),w.main.setLink(e)}catch(e){alert(modx.lang.unable_set_link)}t.preventDefault()}},showPopup:function(e,id,title){if(!e.ctrlKey){e.preventDefault();var tree=d.getElementById("tree"),el=d.getElementById("node"+id)||e.target,x=0,y=0;if(el.firstChild&&el.firstChild.dataset&&el.firstChild.dataset.contextmenu&&(el=el.firstChild),el){if(el.dataset.contextmenu){e.target.dataset.toggle="#contextmenu",modx.hideDropDown(e),this.ctx=d.createElement("div"),this.ctx.id="contextmenu",this.ctx.className="dropdown-menu",d.getElementById(modx.frameset).appendChild(this.ctx),this.setSelectedByContext(id);var dataJson=JSON.parse(el.dataset.contextmenu);for(var key in dataJson)if(dataJson.hasOwnProperty(key)){var item=d.createElement("div");for(var k in dataJson[key])if(dataJson[key].hasOwnProperty(k))if("on"===k.substring(0,2)){var onEvent=dataJson[key][k];item[k]=function(onEvent){return function(event){eval(onEvent)}}(onEvent)}else item[k]=dataJson[key][k];0===key.indexOf("header")&&(item.className+=" menuHeader"),0===key.indexOf("item")&&(item.className+=" menuLink"),(0===key.indexOf("seperator")||0===key.indexOf("separator"))&&(item.className+=" seperator separator"),this.ctx.appendChild(item)}x=0<e.clientX?e.clientX:e.pageX,y=0<e.clientY?e.clientY:e.pageY,e.view.position=e.view.frameElement?e.view.frameElement.getBoundingClientRect():e.target.offsetParent.getBoundingClientRect(),e.view.frameElement?(x+=e.view.position.left,y+=e.view.frameElement.offsetParent.offsetTop):e.target.parentNode.parentNode.classList.contains("node")&&(x+=50),x>e.view.position.width&&(x=e.view.position.width-this.ctx.offsetWidth),y+this.ctx.offsetHeight/2>e.view.position.height?y=e.view.position.height-this.ctx.offsetHeight-5:y-this.ctx.offsetHeight/2<e.view.position.top?y=e.view.position.top+5:y-=this.ctx.offsetHeight/2,this.itemToChange=id,this.selectedObjectName=title,this.dopopup(this.ctx,x+10,y)}else{el=el.firstChild;var ctx=d.getElementById("mx_contextmenu");e.target.dataset.toggle="#mx_contextmenu",modx.hideDropDown(e),this.setSelectedByContext(id);var i4=d.getElementById("item4"),i5=d.getElementById("item5"),i8=d.getElementById("item8"),i9=d.getElementById("item9"),i10=d.getElementById("item10"),i11=d.getElementById("item11");1===modx.permission.publish_document?(i9.style.display="block",i10.style.display="block",1===parseInt(el.dataset.published)?i9.style.display="none":i10.style.display="none"):i5&&(i5.style.display="none"),1===modx.permission.delete_document&&(i4.style.display="block",i8.style.display="block",1===parseInt(el.dataset.deleted)?(i4.style.display="none",i9.style.display="none",i10.style.display="none"):i8.style.display="none"),i11&&(1===parseInt(el.dataset.isfolder)?i11.style.display="block":i11.style.display="none");var bodyHeight=tree.offsetHeight+tree.offsetTop;x=0<e.clientX?e.clientX:e.pageX,y=0<e.clientY?e.clientY:e.pageY,y+ctx.offsetHeight/2>bodyHeight?y=bodyHeight-ctx.offsetHeight-5:y-ctx.offsetHeight/2<tree.offsetTop?y=tree.offsetTop+5:y-=ctx.offsetHeight/2,e.target.parentNode.parentNode.classList.contains("node")&&(x+=50),this.itemToChange=id,this.selectedObjectName=title,ctx.classList.contains("show")?(ctx.classList.remove("show"),setTimeout(function(){modx.tree.dopopup(ctx,x+10,y)},100)):this.dopopup(ctx,x+10,y)}e.stopPropagation()}}},dopopup:function(e,t,n){30<this.selectedObjectName.length&&(this.selectedObjectName=this.selectedObjectName.substr(0,30)+"...");var a=d.getElementById("nameHolder");a.innerHTML=this.selectedObjectName,e.style.left=t+("rtl"===modx.config.textdir?"-190":"")+"px",e.style.top=n+"px",e.classList.add("show")},menuHandler:function(e){1===e?(this.setActiveFromContextMenu(this.itemToChange),modx.tabs({url:modx.MODX_MANAGER_URL+"?a=3&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"})):2===e?(this.setActiveFromContextMenu(this.itemToChange),modx.tabs({url:modx.MODX_MANAGER_URL+"?a=27&r=1&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"})):3===e?modx.tabs({url:modx.MODX_MANAGER_URL+"?a=4&pid="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):4===e?this.selectedObjectDeleted?alert("\""+this.selectedObjectName+"\" "+modx.lang.already_deleted):!0===confirm("\""+this.selectedObjectName+"\"\n\n"+modx.lang.confirm_delete_resource)&&modx.tabs({url:modx.MODX_MANAGER_URL+"?a=6&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):5===e?(this.setActiveFromContextMenu(this.itemToChange),modx.tabs({url:modx.MODX_MANAGER_URL+"?a=51&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"})):6===e?modx.tabs({url:modx.MODX_MANAGER_URL+"?a=72&pid="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):7===e?!0===confirm(modx.lang.confirm_resource_duplicate)&&modx.tabs({url:modx.MODX_MANAGER_URL+"?a=94&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):8===e?d.getElementById("node"+this.itemToChange).firstChild.dataset.deleted?!0===confirm("\""+this.selectedObjectName+"\" "+modx.lang.confirm_undelete)&&modx.tabs({url:modx.MODX_MANAGER_URL+"?a=63&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):alert("\""+this.selectedObjectName+"\""+modx.lang.not_deleted):9===e?!0===confirm("\""+this.selectedObjectName+"\" "+modx.lang.confirm_publish)&&modx.tabs({url:modx.MODX_MANAGER_URL+"?a=61&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):10===e?this.itemToChange===modx.config.site_start?alert("Document is linked to site_start variable and cannot be unpublished!"):!0===confirm("\""+this.selectedObjectName+"\" "+modx.lang.confirm_unpublish)&&modx.tabs({url:modx.MODX_MANAGER_URL+"?a=62&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):11===e?modx.tabs({url:modx.MODX_MANAGER_URL+"?a=56&id="+this.itemToChange,title:this.selectedObjectName+"<small>("+this.itemToChange+")</small>"}):12===e?w.open(d.getElementById("node"+this.itemToChange).firstChild.dataset.href,"previeWin"):alert("Unknown operation command.")},setSelected:function(e){var t=d.querySelector("#tree .current");t&&t.classList.remove("current"),e&&("object"==typeof e?e.classList.add("current"):(t=d.querySelector("#node"+e+">.node")||d.getElementById("node"+e),t&&t.classList.add("current")))},setActiveFromContextMenu:function(e){var t=d.querySelector("#node"+e+">.node");t&&this.setSelected(t)},setSelectedByContext:function(e){var t=d.querySelector("#treeRoot .selected");t&&t.classList.remove("selected"),t=d.querySelector("#node"+e+">.node"),t&&t.classList.add("selected")},setItemToChange:function(){var e=w.main.document&&(w.main.document.URL||modx.normalizeUrl(w.main.document.location.href)),t=modx.getActionFromUrl(e);this.itemToChange=e&&modx.typesactions[t]?(7===modx.typesactions[t]?"":modx.typesactions[t]+"_")+parseInt(modx.main.getQueryVariable("id",e)):"",this.setSelected(this.itemToChange)},restoreTree:function(){d.getElementById("treeRoot")&&(d.getElementById("treeloader").classList.add("visible"),this.setItemToChange(),this.rpcNode=d.getElementById("treeRoot"),modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php","a=1&f=nodes&indent=1&parent="+modx.tree_parent+"&expandAll=2&id="+this.itemToChange,function(e){modx.tree.rpcLoadData(e),modx.tree.draggable()}))},expandTree:function(){this.rpcNode=d.getElementById("treeRoot"),d.getElementById("treeloader").classList.add("visible"),modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php","a=1&f=nodes&indent=1&parent="+modx.tree_parent+"&expandAll=1&id="+this.itemToChange,function(e){modx.tree.rpcLoadData(e),modx.tree.saveFolderState(),modx.tree.draggable()})},collapseTree:function(){this.rpcNode=d.getElementById("treeRoot"),d.getElementById("treeloader").classList.add("visible"),modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php","a=1&f=nodes&indent=1&parent="+modx.tree_parent+"&expandAll=0&id="+this.itemToChange,function(e){modx.openedArray=[],modx.tree.saveFolderState(),modx.tree.rpcLoadData(e),modx.tree.draggable()})},updateTree:function(){this.rpcNode=d.getElementById("treeRoot"),d.getElementById("treeloader").classList.add("visible");var e=d.sortFrm,t="a=1&f=nodes&indent=1&parent="+modx.tree_parent+"&expandAll=2&dt="+e.dt.value+"&tree_sortby="+e.sortby.value+"&tree_sortdir="+e.sortdir.value+"&tree_nodename="+e.nodename.value+"&id="+this.itemToChange+"&showonlyfolders="+e.showonlyfolders.value;modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",t,function(e){modx.tree.rpcLoadData(e),modx.tree.draggable()})},getFolderState:function(){var e;if([0]!==modx.openedArray)for(var t in e="&opened=",modx.openedArray)modx.openedArray[t]&&(e+=t+"|");else e="&opened=";return e},saveFolderState:function(){modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php","a=1&f=nodes&savestateonly=1"+this.getFolderState())},showSorter:function(t){t=t||w.event;var n=d.getElementById("floater");t.target.dataset.toggle="#floater",n.classList.toggle("show"),n.onclick=function(t){t.stopPropagation()}},emptyTrash:function(){!0===confirm(modx.lang.confirm_empty_trash)&&modx.get(modx.MODX_MANAGER_URL+"?a=64",function(){modx.tabsClose(modx.tree.deleted),modx.tree.deleted=[],modx.tree.restoreTree()})},showBin:function(e){var t=d.getElementById("treeMenu_emptytrash");if(t)if(e){t.title=modx.lang.empty_recycle_bin,t.classList.remove("disabled"),t.innerHTML=modx.style.icon_trash,t.onclick=function(){modx.tree.emptyTrash()};for(var n=d.getElementById("tree").querySelectorAll(".deleted"),a=0;a<n.length;a++)this.deleted[n[a].dataset.id]="evo-tab-page-"+modx.urlToUid("a=27&id="+n[a].dataset.id)}else t.title=modx.lang.empty_recycle_bin_empty,t.classList.add("disabled"),t.innerHTML=modx.style.icon_trash_alt,t.onclick=null},unlockElement:function(e,t,n){var a=modx.lockedElementsTranslation.msg.replace("[+id+]",t).replace("[+element_type+]",modx.lockedElementsTranslation["type"+e]);!0===confirm(a)&&modx.get(modx.MODX_MANAGER_URL+"?a=67&type="+e+"&id="+t,function(e){1===parseInt(e)?n.parentNode.removeChild(n):alert(e)})},resizeTree:function(){}},removeLocks:function(){!0===confirm(modx.lang.confirm_remove_locks)&&modx.get(modx.MODX_MANAGER_URL+"?a=67",function(){modx.tree.restoreTree()})},keepMeAlive:function(){modx.get("includes/session_keepalive.php?tok="+d.getElementById("sessTokenInput").value+"&o="+Math.random(),function(e){e=JSON.parse(e),"ok"!==e.status&&(w.location.href=modx.MODX_MANAGER_URL+"?a=8")})},updateMail:function(e){try{e&&this.post(modx.MODX_MANAGER_URL,{updateMsgCount:!0},function(e){var t=e.split(","),n=d.getElementById("msgCounter");0<t[0]?n&&(n.innerHTML=t[0],n.style.display="block"):n&&(n.style.display="none"),0<t[1]&&(n=d.getElementById("newMail"),n&&(n.innerHTML="<a href=\"javascript:;\" onclick=\"modx.tabs({url:'"+modx.MODX_MANAGER_URL+"?a=10',title:'"+modx.lang.inbox+"'});\">"+modx.style.email+modx.lang.inbox+" ("+t[0]+" / "+t[1]+")</a>",n.style.display="block")),0<modx.config.mail_check_timeperiod&&setTimeout("modx.updateMail(true)",1e3*modx.config.mail_check_timeperiod)})}catch(e){setTimeout("modx.updateMail(true)",1e3*modx.config.mail_check_timeperiod)}},openWindow:function(e){"object"!=typeof e&&(e={url:e}),e.width||(e.width=parseInt(.9*w.innerWidth)+"px"),e.height||(e.height=parseInt(.8*w.innerHeight)+"px"),e.left||(e.left=parseInt(.05*w.innerWidth)+"px"),e.top||(e.top=parseInt(.1*w.innerHeight)+"px"),e.title||(e.title=Math.floor(999999*Math.random()+1)),e.url&&(1===this.plugins.EVOmodal?top.EVO.modal.show(e):w.open(e.url,e.title,"width="+e.width+",height="+e.height+",top="+e.top+",left="+e.left+",toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no"))},tabsClose:function(e){if(modx.config.global_tabs&&e)for(var t in e)if(e.hasOwnProperty(t)){var n=d.getElementById(e[t]);n&&(n.firstElementChild.contentWindow.documentDirty=!1,n.close())}},tabs:function(t){function n(e){var t=this;this.url=e.url.replace(new RegExp(modx.MODX_MANAGER_URL,"g"),""),this.title=e.title||"",this.name=e.name||"",this.timer=null,this.olduid="",this.closeactions=[6,61,62,63,94],this.saveAndCloseActions=[75,76,86,99,106],this.reload="undefined"==typeof e.reload?1:e.reload,this.action=modx.getActionFromUrl(e.url),this.getTab=modx.main.getQueryVariable("tab",e.url),this.uid=modx.getActionFromUrl(e.url,2)?"home":modx.urlToUid(e.url),this.page=d.getElementById("evo-tab-page-"+this.uid),this.row=d.getElementsByClassName("evo-tab-row")[0].firstElementChild,this.tab=d.getElementById("evo-tab-"+this.uid),this.page?"home"===this.uid?this.reload?(this.page.firstElementChild.src=this.url,this.show()):(this.reload=1,null===this.tab.onclick&&(this.tab.onclick=function(n){t.select.call(t,n,this)}),this.tab.show=function(n){t.show.call(t,n)},modx.tabs.selected=this.tab):(this.show(),~this.closeactions.indexOf(this.action)&&(this.setDocPublished(),modx.get(this.url,function(){modx.tree.restoreTree()}))):~this.closeactions.indexOf(this.action)?modx.get(this.url,function(){modx.tree.restoreTree()}):this.create()}if(n.prototype={create:function(){var t=this;modx.main.work(),modx.tabs.selected=this.row.querySelector(".selected"),modx.tabs.selected&&(d.getElementById(modx.tabs.selected.id.replace("tab","tab-page")).classList.remove("show"),modx.tabs.selected.classList.remove("selected")),this.page=d.createElement("div"),this.page.id="evo-tab-page-"+this.uid,this.page.className="evo-tab-page iframe-scroller show",this.page.innerHTML=/iPhone|iPad|iPod/i.test(navigator.userAgent)?"<iframe class=\"tabframes\" src=\""+this.url+"\" name=\""+this.name+"\" width=\"100%\" height=\"100%\" scrolling=\"no\" frameborder=\"0\"></iframe>":"<iframe class=\"tabframes\" src=\""+this.url+"\" name=\""+this.name+"\" width=\"100%\" height=\"100%\" scrolling=\"auto\" frameborder=\"0\"></iframe>",d.getElementById("main").appendChild(this.page),this.page.firstElementChild.onload=function(n){t.onload.call(t,n)},this.tab=d.createElement("h2"),this.tab.id="evo-tab-"+this.uid,this.tab.className="tab selected",this.icon="",/<i/.test(this.title)||(this.icon="<i class=\""+modx.setTypeIcon(this.action)+"\"></i>"),this.tab.innerHTML="<span class=\"tab-title\" title=\""+this.title.replace(/<\/?[^>]+>/g,"")+"\">"+this.icon+this.title+"</span><span class=\"tab-close\">\xD7</span>",this.row.appendChild(this.tab),this.tab.onclick=function(n){t.select.call(t,n,this)},this.tab.close=function(n){t.close.call(t,n)},this.tab.show=function(n){t.show.call(t,n)},this.page.close=function(n){t.close.call(t,n)}},onload:function(t){var n=this;if(w.main=t.target.contentWindow||t.target.defaultView,this.url=modx.normalizeUrl(w.main.location.href),this.olduid=this.uid,this.uid=modx.urlToUid(this.url),!!w.main.__alertQuit){w.main.alert=function(){};var e=w.main.document.body.innerHTML;w.main.document.body.style.display="none",history.pushState(null,d.title,modx.getActionFromUrl(this.url,2)?modx.MODX_MANAGER_URL:"#"+this.url),w.onpopstate=function(){history.go(1)},modx.popup({type:"warning",title:"Evolution CMS :: Alert",position:"top center alertQuit",content:e,wrap:"body"}),modx.getLockedElements(modx.getActionFromUrl(this.url),modx.main.getQueryVariable("id",this.url),function(e){!!e||~n.closeactions.indexOf(modx.getActionFromUrl(n.url))?(n.page.close(),modx.tree.restoreTree()):(w.main.location.href=modx.MODX_MANAGER_URL+n.url,w.history.replaceState(null,d.title,modx.getActionFromUrl(n.url,2)?modx.MODX_MANAGER_URL:"#"+n.url))})}else modx.getActionFromUrl(this.url,2)||~this.saveAndCloseActions.indexOf(modx.getActionFromUrl(this.url))&&parseInt(modx.main.getQueryVariable("r",this.url))?this.close(t):this.olduid!==this.uid&&d.getElementById("evo-tab-"+this.uid)?(this.close(t),d.getElementById("evo-tab-"+this.uid).show()):(this.title=w.main.document.body.querySelectorAll("h1")[0]&&w.main.document.body.querySelectorAll("h1")[0].innerHTML||this.title,this.title&&"home"!==this.uid&&(this.tab.innerHTML="<span class=\"tab-title\" title=\""+this.title.replace(/<\/?[^>]+>/g,"")+"\">"+this.title+"</span><span class=\"tab-close\">\xD7</span>"),this.page.id="evo-tab-page-"+this.uid,this.tab.id="evo-tab-"+this.uid,this.tab.classList.remove("changed"),this.show(),modx.main.onload(t),w.main.document.addEventListener("click",function t(a){"undefined"!=typeof a.view.documentDirty&&a.view.documentDirty&&!n.tab.classList.contains("changed")&&(n.tab.classList.add("changed"),this.removeEventListener(a.type,t,!1))},!1),w.main.document.addEventListener("keyup",function t(a){"undefined"!=typeof a.view.documentDirty&&a.view.documentDirty&&!n.tab.classList.contains("changed")&&(n.tab.classList.add("changed"),this.removeEventListener(a.type,t,!1))},!1))},show:function(){modx.tabs.selected=this.row.querySelector(".selected"),modx.tabs.selected&&modx.tabs.selected!==this.tab&&(d.getElementById(modx.tabs.selected.id.replace("tab","tab-page")).classList.remove("show"),modx.tabs.selected.classList.remove("selected")),this.page.classList.add("show"),this.tab.classList.add("selected"),modx.tabs.selected=this.tab,w.main=this.page.firstElementChild.contentWindow,this.getTab&&76===this.action&&!~w.main.frameElement.contentDocument.location.href.indexOf(this.url)?w.main.frameElement.src=this.url:(w.history.replaceState(null,w.main.document.title,modx.getActionFromUrl(this.url,2)?modx.MODX_MANAGER_URL:"#"+this.url),modx.tree.setItemToChange(),modx.main.tabRow.scroll(this.row,this.tab,350))},close:function(t){var e=this.page.firstElementChild.contentWindow.documentDirty,n=!!this.page.firstElementChild.contentWindow.checkDirt;(e&&n&&confirm(this.page.firstElementChild.contentWindow.checkDirt(t))||!e)&&(modx.tabs.selected===this.tab&&(tree.ca="open"),modx.tabs.selected=this.tab.classList.contains("selected")?this.tab.previousElementSibling:this.row.querySelector(".selected"),this.page.parentNode.removeChild(this.page),this.row.removeChild(this.tab),modx.tabs.selected.show()),modx.main.stopWork()},select:function(t){if("tab-close"===t.target.className)this.close(t);else if(modx.tabs.selected===this.tab){var e=this;this.timer?(clearTimeout(this.timer),this.timer=null,w.main.location.reload()):this.timer=setTimeout(function(){e.timer=null},250)}else this.show()},setDocPublished:function(){var e=w.main.document.getElementsByName("publishedcheck")[0];e&&(e.checked=61===this.action,w.main.document.getElementsByName("published")[0].value=+e.checked),modx.getActionFromUrl(modx.normalizeUrl(w.main.location.href),3)&&w.main.location.reload()}},!modx.config.global_tabs)t.url&&(w.main?w.main.frameElement.src=t.url:modx.openWindow(t.url));else if("undefined"!=typeof t.currentTarget){var o=t;0===o.button&&o.target&&("A"===o.target.tagName&&"main"===o.target.target||o.target.parentNode&&"A"===o.target.parentNode.tagName&&"main"===o.target.parentNode.target)&&(t="A"===o.target.tagName&&o.target||"A"===o.target.parentNode.tagName&&o.target.parentNode,o.shiftKey?modx.openWindow({url:t.href}):modx.tabs({url:t.href,title:t.innerHTML}),o.preventDefault())}else return new n(t)},popup:function(t){if("object"==typeof t&&(t.url||t.content||t.text)){var n={addclass:"",animation:"fade",content:t.content||t.text||"",clickclose:0,closeall:0,data:"",dataType:"document",delay:5e3,draggable:!1,event:null,height:"auto",hide:1,hover:1,icon:"",iframe:"iframe",margin:".5rem",maxheight:"",method:"GET",overlay:0,overlayclose:0,position:"center",resize:!1,selector:"",showclose:1,target:"main",uid:"",type:"default",title:"",url:"",width:"20rem",wrap:t.wrap||w.main.document.body,zIndex:10500,w:null,show:function(){~n.position.indexOf("center")&&(n.event?(n.el.style.left=n.event.clientX+n.mt+"px",n.el.style.bottom=n.w.innerHeight-n.el.offsetHeight-n.event.clientY+n.mt+"px"):(n.el.style.left=/(%)/.test(n.width)?(100-parseInt(n.width))/2-n.mt/(n.w.innerWidth/100)+"%":(n.w.innerWidth-n.el.offsetWidth)/2-n.mt+"px",n.el.style.bottom=/(%)/.test(n.height)?(100-parseInt(n.height))/2-n.mt/(n.w.innerHeight/100)+"%":(n.w.innerHeight-n.el.offsetHeight-n.wrap.offsetTop)/2-n.mt+"px")),~n.position.indexOf("left")&&(n.el.style.left=0),n.el.style.right=~n.position.indexOf("right")?0:"auto",~n.position.indexOf("top")?(n.el.style.top=0,n.el.style.bottom=""):n.el.style.top="auto",~n.position.indexOf("bottom")&&(n.el.style.bottom=0),n.calc(),n.el.className+=" in",n.showclose&&(n.el.querySelector(".close").onclick=n.close),n.hide&&(n.el.timer=setTimeout(function(){clearTimeout(n.el.timer),n.close()},n.delay)),n.hover&&(n.el.onmouseenter=function(){clearTimeout(n.el.timer)},n.el.onmouseleave=n.close),n.overlayclose&&n.o&&(n.o.onclick=n.close),n.clickclose&&(n.el.onclick=n.close),n.draggable&&modx.dragging(n.el,{wrap:n.wrap,resize:n.resize}),n.el.classList.add("show")},close:function(t){if(n.event=t||n.event||w.event,n.url&&"iframe"===n.iframe){var e=n.wrap.ownerDocument.querySelectorAll("."+n.className+".in");if(e){var a=n.el.lastElementChild.firstElementChild.contentWindow.documentDirty;(a&&confirm(n.el.lastElementChild.firstElementChild.contentWindow.checkDirt(n.event))||!a)&&(n.el.classList.remove("in"),!n.animation&&n.el.classList.remove("show"),n.calc(1),n.o&&n.o.parentNode&&(n.o.parentNode.removeChild(n.o),n.wrap.style.overflow=""),n.el.timer=setTimeout(function(){clearTimeout(n.el.timer),n.el.parentNode&&n.el.parentNode.removeChild(n.el)},200))}}else n.el.classList.remove("in"),n.animation||n.el.classList.remove("show"),n.calc(1),n.o&&n.o.parentNode&&(n.o.parentNode.removeChild(n.o),n.wrap.style.overflow=""),n.el.timer=setTimeout(function(){clearTimeout(n.el.timer),n.el.parentNode&&n.el.parentNode.removeChild(n.el)},200);"function"==typeof n.onclose&&n.onclose(t,n.el)},calc:function(e){var t=n.wrap.ownerDocument.querySelectorAll("."+n.className+".in[data-position=\""+n.el.dataset.position+"\"]");if(t&&t.length){n.els=[];for(var a=0;a<t.length;a++)n.els.push(t[a]);for(n.els.sort(function(e,t){return e.index-t.index}),n.t=0,n.t=0===n.position.indexOf("center")?e?(n.w.innerHeight-n.els[n.els.length-1].offsetHeight)/2-n.mt:(n.w.innerHeight+n.el.offsetHeight)/2:e?0:n.el.offsetHeight+n.mt,a=n.els.length;a--;)n.wrap.ownerDocument.getElementById(n.els[a].id).index=a-n.els.length,~n.position.indexOf("top")?n.wrap.ownerDocument.getElementById(n.els[a].id).style.top=n.t+"px":n.wrap.ownerDocument.getElementById(n.els[a].id).style.bottom=n.t+"px",n.t+=n.els[a].offsetHeight+n.mt,n.closeall&&n.el!==t[a]&&n.els[a].close()}},onclose:function(){}};for(var e in t)t.hasOwnProperty(e)&&"undefined"!=typeof n[e]&&(n[e]=t[e]);if(n.timer=0,n.position=n.position.split(" "),modx.popupLastIndex?n.zIndex=modx.popupLastIndex++:modx.popupLastIndex=n.zIndex,n.uid=t.url?modx.urlToUid(t.url):modx.toHash(t),n.className="evo-popup","string"==typeof n.wrap&&(n.wrap=d.querySelector(n.wrap)),n.w=n.wrap.ownerDocument.defaultView||n.wrap.ownerDocument.parentWindow,n.overlay&&(n.wrap.querySelector(".evo-popup-overlay")?(n.o=n.wrap.querySelector(".evo-popup-overlay"),n.o.style.zIndex=n.zIndex-1):(n.o=d.createElement("div"),n.o.className="evo-popup-overlay",n.o.style.zIndex=n.zIndex-1,n.wrap.appendChild(n.o),n.wrap.style.overflow="hidden")),n.el=n.wrap.ownerDocument.getElementById("evo-popup-"+n.uid),n.el)clearTimeout(n.el.timer),n.el.index=0,n.el.classList.remove("in"),n.el.classList.add("show"),n.el.style.zIndex=n.zIndex,n.el.dataset.position=n.position.join(":"),n.mt=parseFloat(getComputedStyle(n.el).marginTop),n.el.close=n.close,n.show();else if(n.el=d.createElement("div"),n.el.id="evo-popup-"+n.uid,n.el.close=n.close,n.el.index=0,n.el.style.position="fixed",n.el.style.width=/[^[0-9]/.test(n.width)?n.width:n.width+"px",n.el.style.height=/[^[0-9]/.test(n.height)?n.height:n.height+"px",n.el.style.zIndex=n.zIndex,n.el.style.margin=n.margin,n.el.className=n.className+" alert alert-"+n.type+" "+n.addclass+(n.animation?" animation "+n.animation:""),n.el.dataset.position=n.position.join(":"),n.showclose&&(n.el.innerHTML+="<div class=\"evo-popup-close close\">&times;</div>"),n.title&&(n.header=document.createElement("div"),"none"!==n.icon&&(n.header.innerHTML+="<i class=\"fa fa-fw "+(n.icon?n.icon:"fa-"+n.type)+"\"></i>"),n.header.innerHTML+=n.title,n.header.className="evo-popup-header",n.el.appendChild(n.header)),n.el.innerHTML+="<div class=\"evo-popup-body\"></div>",n.wrap.appendChild(n.el),n.mt=parseFloat(getComputedStyle(n.el).marginTop),n.maxheight&&(n.maxheight=/(%)/.test(n.maxheight)?(n.w.innerHeight-n.el.offsetHeight-n.mt)/100*parseInt(n.maxheight):n.maxheight,n.el.lastChild.style.overflowY="auto",n.el.lastChild.style.maxHeight=n.maxheight+"px"),!n.url)n.el.lastChild.innerHTML+=n.content,n.show();else if(n.draggable=1,"iframe"===n.iframe)n.resize=1,n.uid=modx.urlToUid(t.url),n.el.className+=" "+n.addclass+" "+n.className+"-iframe",n.el.id="evo-popup-"+n.uid,d.getElementById("mainloader").className="show",n.frame=d.createElement("iframe"),n.frame.width="100%",n.frame.height="100%",n.frame.frameBorder="0",n.frame.src=n.url,n.frame.onload=function(a){a.target.contentWindow.opener=n.w,t.url=a.target.contentWindow.location.href,n.uid=modx.urlToUid(t.url),n.event=a,a.target.contentWindow.__alertQuit?(modx.popup({type:"warning",title:"Evolution CMS :: Alert",position:"top center alertQuit",content:a.target.contentWindow.document.body.querySelector("p").innerHTML}),a.target.contentWindow.document.body.innerHTML="",a.target.contentWindow.alert=function(){}):modx.getActionFromUrl(t.url,2)||1<n.wrap.querySelectorAll("#evo-popup-"+n.uid).length?n.el.close():(a.target.contentDocument.querySelectorAll("h1")[0]?t.title=a.target.contentDocument.querySelectorAll("h1")[0].innerHTML:a.target.contentDocument.title&&(t.title=a.target.contentDocument.title),n.header&&(a.target.offsetParent.offsetParent.getElementsByClassName(n.header.className)[0].innerHTML=t.title),a.target.offsetParent.offsetParent.id="evo-popup-"+n.uid,a.target.offsetParent.offsetParent.classList.remove("changed")),a.target.contentWindow.close=n.close,modx.main.stopWork()},n.el.lastChild.appendChild(n.frame),n.show();else{var a=new XMLHttpRequest;a.open(n.method,n.url,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),a.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest"),n.dataType&&(a.responseType=n.dataType),a.onload=function(){if(4===this.readyState){if(n.el.className+=" "+n.className+"-ajax","document"!==n.dataType)n.el.lastChild.innerHTML+=this.response;else if(n.selector){var e=this.response.documentElement.querySelector(n.selector);e&&(n.el.lastChild.innerHTML+=e.innerHTML)}else n.el.lastChild.innerHTML+=this.response.body.innerHTML;n.show()}},a.send(n.data)}return n}},getWindowDimension:function(){var t=0,n=0,o=d.documentElement,i=d.body;return"number"==typeof w.innerWidth?(t=w.innerWidth,n=w.innerHeight):o&&(o.clientWidth||o.clientHeight)?(t=o.clientWidth,n=o.clientHeight):i&&(i.clientWidth||i.clientHeight)&&(t=i.clientWidth,n=i.clientHeight),{width:t,height:n}},hideDropDown:function(a){if(a=a||w.event||w.main.event,("open"===tree.ca||""===tree.ca)&&modx.tree.setSelectedByContext(),null!==modx.tree.ctx&&(d.getElementById(modx.frameset).removeChild(modx.tree.ctx),modx.tree.ctx=null),!/dropdown\-item/.test(a.target.className)){var o,s=d.querySelectorAll(".dropdown.show"),r=null,l=a.target||a.target.parentNode;for("undefined"==typeof l.dataset.toggle?l.classList.contains("dropdown-toggle")&&(r=l.offsetParent):r=d.querySelector(l.dataset.toggle),o=0;o<s.length;o++)r!==s[o]&&s[o].classList.remove("show");for(s=w.main&&w.main.document.querySelectorAll(".dropdown.show")||[],o=0;o<s.length;o++)r!==s[o]&&s[o].classList.remove("show")}},XHR:function(){return"XMLHttpRequest"in w?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},get:function(e,t,n){var a=this.XHR();a.open("GET",e,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n&&(a.responseType=n),a.onload=function(){if(200===this.status&&"function"==typeof t)return t(this.response)},a.send()},post:function(n,a,o,s){var r=this.XHR(),l="";if("function"==typeof a)s=o,o=a;else if("object"==typeof a){var d,m=[],e=0;for(d in a)a.hasOwnProperty(d)&&(m[e++]=d+"="+a[d]);l=m.join("&")}else"string"==typeof a&&(l=a);r.open("POST",n,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.setRequestHeader("X-REQUESTED-WITH","XMLHttpRequest"),s&&(r.responseType=s),r.onload=function(){if(4===this.readyState&&o!==u)return o(this.response)},r.send(l)},pxToRem:function(e){return e/parseInt(w.getComputedStyle(d.documentElement).fontSize)},remToPx:function(e){return e*parseInt(w.getComputedStyle(d.documentElement).fontSize)},toHash:function(e){e=JSON.stringify(e)+"";var t,n,o=0;if(0===e.length)return o;for(n=0;n<e.length;n++)t=e.charCodeAt(n),o=(o<<5)-o+t,o&=o;return Math.abs(o).toString()},urlToUid:function(e){var t,n="";return e=e.split("?"),e=e[1]||e[0],e&&(t=modx.getActionFromUrl(e),t&&(modx.typesactions[t]?n+="&type="+modx.typesactions[t]:n+="&a="+t),modx.main.getQueryVariable("id",e)&&(n+="&id="+modx.main.getQueryVariable("id",e)),modx.main.getQueryVariable("type",e)&&(n+="&type="+modx.main.getQueryVariable("type",e)),n=modx.toHash(n)),n},getActionFromUrl:function(e,t){return"undefined"==typeof t?parseInt(modx.main.getQueryVariable("a",e)):parseInt(modx.main.getQueryVariable("a",e))===parseInt(t)},normalizeUrl(e){return e=e.replace(new RegExp(modx.MODX_MANAGER_URL,"g"),""),e=e.replace(/^index\.php/,""),e=e.replace(/^#/,""),e},getLockedElements:function(e,t,n){modx.typesactions[e]&&t&&modx.post(modx.MODX_MANAGER_URL+"media/style/"+modx.config.theme+"/ajax.php",{a:"getLockedElements",id:modx.main.getQueryVariable("id",modx.normalizeUrl(w.main.location.href)),type:modx.typesactions[modx.getActionFromUrl(modx.normalizeUrl(w.main.location.href))]},n)},dragging:function(e,t){return this.dragging.init=function(e,t){var n={resize:!1,minWidth:50,minHeight:50,wrap:document,opacity:"0.65",classDrag:"drag",classResize:"resize",handler:"",onstart:function(){},onstop:function(){},ondrag:function(){},onresize:function(){}},a={x:0,y:0,elmX:0,elmY:0,border:5,isdrag:!1,isresize:!1,onTop:0,onLeft:0,onRight:0,onBottom:0,handlerHeight:e.offsetHeight,borders:document.createElement("div")},o=modx.extend(this,n,t,a);this.el=e,this.borders.className="border-outline",this.borders.innerHTML="<i class=\"bo-left\"></i><i class=\"bo-top\"></i><i class=\"bo-right\"></i><i class=\"bo-bottom\"></i>",this.classDrag&&this.el.classList.add(this.classDrag),this.classResize&&this.el.classList.add(this.classResize),this.el.insertBefore(this.borders,this.el.firstChild),this.handler&&this.el.getElementsByClassName(this.handler)[0]&&(this.handler=this.el.getElementsByClassName(this.handler)[0],this.handlerHeight=this.handler.offsetHeight),this.el.onmousedown=function(t){o.mousedown(t)},this.el.ontouchstart=function(t){o.mousedown(t.changedTouches[0])},this.wrap.addEventListener("mousemove",function(t){o.calc(t)},!1),this.wrap.addEventListener("touchmove",function(t){o.calc(t.changedTouches[0])},!1)},this.dragging.init.prototype={mousedown:function(t){if(!t.target.classList.contains("close")){t=document.all?window.event:t;var n=this,a=document.all?window.event.clientX:t.clientX,o=document.all?window.event.clientY:t.clientY,i=w.getComputedStyle(this.el);this.elmX=a-this.el.offsetLeft+parseInt(i.marginLeft),this.elmY=o-this.el.offsetTop+parseInt(i.marginTop),this.el.position=this.el.getBoundingClientRect(),this.el.style.position="fixed",this.el.style.transitionDuration="0s",this.el.style.webkitTransitionDuration="0s",this.el.style.left=this.el.offsetLeft-parseInt(i.marginLeft)+"px",this.el.style.top=this.el.offsetTop-parseInt(i.marginTop)+"px",this.el.style.right="auto",this.el.style.bottom="auto",this.el.style.width=this.el.position.width+"px",this.el.style.height=this.el.position.height+"px",t.target.parentNode===this.borders?(this.isresize=this.resize,this.el.classList.add("is-resize")):(!this.handler||this.handler&&t.target===this.handler)&&(this.isdrag=!0,this.el.classList.add("is-drag")),"function"==typeof this.start&&this.onstart(t,this.el),t.preventDefault?t.preventDefault():document.onselectstart=function(){return!1},this.wrap.onmousemove=function(t){n.mousemove(t)},this.wrap.ontouchmove=function(t){n.mousemove(t.changedTouches[0]),t.stopPropagation()},this.wrap.onmouseup=function(t){n.mouseup(t)},this.wrap.ontouchend=function(t){n.mouseup(t.changedTouches[0]),t.stopPropagation()}}},mousemove:function(t){var e=document.all?window.event.clientX:t.clientX,n=document.all?window.event.clientY:t.clientY;if(this.isresize){if(this.onRight&&(this.el.style.width=Math.max(e-this.el.position.left+(this.el.position.width-this.x),this.minWidth)+"px"),this.onBottom&&(this.el.style.height=Math.max(n-this.el.position.top+(this.el.position.height-this.y),this.minHeight)+"px"),this.onLeft&&(this.width=Math.max(this.el.position.left-e+this.el.position.width+this.x,this.minWidth),this.width>this.minWidth&&(this.el.style.width=this.width+"px",this.el.style.left=e-this.elmX+"px")),this.onTop){var a=Math.max(this.el.position.top-n+this.el.position.height+this.y,this.minHeight);a>this.minHeight&&(this.el.style.height=a+"px",this.el.style.top=n-this.elmY+"px")}"function"==typeof this.onresize&&this.onresize(t,this.el)}else this.isdrag&&(this.el.style.opacity=this.opacity,this.el.style.left=e-this.elmX+"px",this.el.style.top=n-this.elmY+"px","function"==typeof this.drag&&this.ondrag(t,this.el))},mouseup:function(t){(this.isdrag||this.isresize)&&(this.el.classList.remove("is-resize"),this.el.classList.remove("is-drag"),this.el.style.opacity="",this.el.style.transitionDuration="",this.el.style.webkitTransitionDuration="",this.el.position=this.el.getBoundingClientRect(),this.isdrag=!1,this.isresize=!1,this.wrap.onmousemove=null,this.wrap.onselectstart=null,"function"==typeof this.stop&&this.onstop(t,this.el))},calc:function(t){this.isresize||this.isdrag||(this.x=t.clientX-this.el.offsetLeft,this.y=t.clientY-this.el.offsetTop,this.resize?(this.onTop=this.y<this.border,this.onLeft=this.x<this.border,this.onRight=this.x>=this.el.offsetWidth-this.border,this.onBottom=this.y>=this.el.offsetHeight-this.border,this.el.style.cursor=this.onRight&&this.onBottom||this.onLeft&&this.onTop?"nwse-resize":this.onRight&&this.onTop||this.onBottom&&this.onLeft?"nesw-resize":this.onRight||this.onLeft?"ew-resize":this.onBottom||this.onTop?"ns-resize":0<this.x&&0<this.y&&this.x<this.el.offsetWidth&&this.y<=this.handlerHeight&&this.y>=this.border?"move":"default"):0<this.x&&0<this.y&&this.x<this.el.offsetWidth&&this.y<=this.handlerHeight&&this.y>=this.border&&(this.el.style.cursor="move"))}},new this.dragging.init(e,t)},setTypeIcon:function(e){var t="";switch(this.typesactions[e]){case 1:t=modx.style.icon_template;break;case 2:t=modx.style.icon_tv;break;case 3:t=modx.style.icon_chunk;break;case 4:t=modx.style.icon_code;break;case 5:t=modx.style.icon_plugin;break;case 6:t=modx.style.icon_element;break;case 7:t=modx.style.icon_edit;break;default:t=modx.style.icon_circle;}return t}}),w.mainMenu={},w.mainMenu.stopWork=function(){modx.main.stopWork()},w.mainMenu.work=function(){modx.main.work()},w.mainMenu.reloadtree=function(){modx.plugins.ElementsInTree&&setTimeout("reloadElementsInTree()",50),modx.config.global_tabs&&setTimeout("modx.tree.restoreTree()",100)},w.mainMenu.startrefresh=function(e){1===e,2===e,9===e&&modx.tree.restoreTree(),10===e&&(w.location.href=modx.MODX_MANAGER_URL)},w.mainMenu.startmsgcount=function(e,t,n){modx.updateMail(n)},w.mainMenu.hideTreeFrame=function(){modx.resizer.setWidth(0)},w.mainMenu.defaultTreeFrame=function(){modx.resizer.setDefaultWidth()},w.tree={},w.tree.ca="open",w.tree.document=document,w.tree.saveFolderState=function(){},w.tree.updateTree=function(){modx.tree.updateTree()},w.tree.restoreTree=function(){modx.tree.restoreTree()},w.tree.resizeTree=function(){},w.onbeforeunload=function(){var e=w.main.frameElement.contentWindow,t=modx.normalizeUrl(e.location.href);modx.getActionFromUrl(t,27)&&modx.get(modx.MODX_MANAGER_URL+"?a=67&type=7&id="+modx.main.getQueryVariable("id",t))},d.addEventListener("DOMContentLoaded",function(){modx.init()})})("undefined"==typeof jQuery?"":jQuery,window,document,void 0),function(){Element.prototype.closest||(Element.prototype.closest=function(e){var t,n,a=this;if(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]&&(t=e,!0)}),a&&t&&a[t](e))return a;for(;a;){if(n=a.parentElement,n&&t&&n[t](e))return n;a=n}return null})}();
